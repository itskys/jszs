<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆç»©ç®¡ç†åå° - 2025çŸ¥è¯†ç«èµ›</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; background: #f4f4f9; color: #333; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        h1 { margin-top: 0; color: #2d5a27; border-bottom: 2px solid #eee; padding-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        
        button {
            background-color: #2d5a27; color: white; border: none; padding: 10px 20px;
            border-radius: 5px; cursor: pointer; font-size: 14px;
        }
        button:hover { background-color: #1e3d1a; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f8f9fa; font-weight: bold; color: #555; }
        tr:nth-child(even) { background-color: #fcfcfc; }
        tr:hover { background-color: #f0f0f0; }

        .score-pass { color: #28a745; font-weight: bold; }
        .score-fail { color: #dc3545; font-weight: bold; }
        .meta-info { font-size: 12px; color: #999; }
    </style>
</head>
<body>

<div class="container">
    <h1>
        <span>ğŸ“‹ è€ƒç”Ÿæˆç»©ç›‘æ§</span>
        <button onclick="loadData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
    </h1>
    
    <div id="status" style="margin-bottom:10px; color:#666; font-size:13px;">ç‚¹å‡»åˆ·æ–°åŠ è½½æ•°æ®...</div>

    <table>
        <thead>
            <tr>
                <th style="width: 50px;">ID</th>
                <th>å§“å</th>
                <th>å­¦å· / ç­çº§</th>
                <th style="width: 80px;">åˆ†æ•°</th>
                <th>ç­”å¯¹/æ€»é¢˜</th>
                <th>è€—æ—¶</th>
                <th>æäº¤æ—¶é—´</th>
            </tr>
        </thead>
        <tbody id="table-body">
            </tbody>
    </table>
</div>

<script>
    async function loadData() {
        const tbody = document.getElementById('table-body');
        const status = document.getElementById('status');
        
        status.innerText = "â³ æ­£åœ¨è¿æ¥æ•°æ®åº“...";
        tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:20px; color:#999;">åŠ è½½ä¸­...</td></tr>';

        try {
            // è¯·æ±‚åç«¯æ¥å£
            const res = await fetch('/api/records');
            
            if (!res.ok) throw new Error("API è¯·æ±‚å¤±è´¥");
            
            const data = await res.json();
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:20px;">æš‚æ— è€ƒè¯•æ•°æ®</td></tr>';
                status.innerText = "âœ… åŠ è½½å®Œæˆï¼Œæš‚æ— æ•°æ®";
                return;
            }

            tbody.innerHTML = ''; // æ¸…ç©ºåŠ è½½åŠ¨ç”»

            data.forEach(row => {
                const tr = document.createElement('tr');
                
                // åˆ¤æ–­åˆ†æ•°é¢œè‰²
                const scoreClass = row.score >= 60 ? 'score-pass' : 'score-fail';
                
                tr.innerHTML = `
                    <td class="meta-info">${row.id}</td>
                    <td style="font-weight:bold;">${escapeHtml(row.student_name)}</td>
                    <td>${escapeHtml(row.student_id)}</td>
                    <td class="${scoreClass}" style="font-size:16px;">${row.score}</td>
                    <td>${row.correct_count} / 300</td>
                    <td>${row.duration}</td>
                    <td class="meta-info">${row.submit_time}</td>
                `;
                tbody.appendChild(tr);
            });
            
            status.innerText = `âœ… åŠ è½½æˆåŠŸï¼Œå…± ${data.length} æ¡è®°å½• (æœ€åæ›´æ–°: ${new Date().toLocaleTimeString()})`;

        } catch (e) {
            console.error(e);
            tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; color:red; padding:20px;">æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–åç«¯é…ç½®ã€‚</td></tr>';
            status.innerText = "âŒ åŠ è½½å‡ºé”™";
        }
    }

    // ç®€å•çš„é˜²XSSå¤„ç†
    function escapeHtml(text) {
        if (!text) return "-";
        return text.replace(/&/g, "&amp;")
                   .replace(/</g, "&lt;")
                   .replace(/>/g, "&gt;")
                   .replace(/"/g, "&quot;")
                   .replace(/'/g, "&#039;");
    }

    // é¡µé¢æ‰“å¼€è‡ªåŠ¨åŠ è½½
    window.onload = loadData;
</script>

</body>
</html>