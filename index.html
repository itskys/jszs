<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025å¹´å†›äº‹çŸ¥è¯†ç«èµ›æ¨¡æ‹Ÿç³»ç»Ÿ</title>
    <style>
        :root {
            --primary: #2d5a27;   /* ä¸»è‰²è°ƒï¼šæ·±ç»¿ */
            --accent: #d9534f;    /* å¼ºè°ƒè‰²ï¼šçº¢è‰² */
            --review-bg: #fff3cd; /* å¤ä¹ æ¨¡å¼èƒŒæ™¯ */
            --review-text: #856404;
            --bg: #f4f4f9;
            --card: #fff;
            --text: #333;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg);
            margin: 0; padding: 0;
            color: var(--text);
            line-height: 1.5;
            -webkit-overflow-scrolling: touch; 
            display: flex; flex-direction: column;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
            flex: 1;
            width: 100%;
        }

        /* Header */
        .header {
            text-align: center; margin-bottom: 20px; padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
            display: flex; flex-direction: column; align-items: center;
        }
        .logo-box {
            width: 50px; height: 50px; background: var(--primary); color: white;
            font-weight: 900; font-size: 28px; line-height: 50px; text-align: center;
            border-radius: 8px; letter-spacing: -2px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); margin-bottom: 10px;
        }
        .header h1 { color: var(--primary); margin: 5px 0; font-size: 22px; }
        .sub-title { color: #666; font-size: 13px; }

        /* Components */
        .card-box {
            background: var(--card); padding: 20px; border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 20px;
        }
        .btn {
            background: var(--primary); color: white; border: none; padding: 12px 20px;
            font-size: 16px; border-radius: 8px; cursor: pointer; transition: 0.2s;
            font-weight: bold; box-shadow: 0 3px #1e3d1a; width: 100%;
        }
        .btn:active { transform: translateY(2px); box-shadow: 0 1px #1e3d1a; }
        .btn.danger { background: var(--accent); box-shadow: 0 3px #c9302c; }
        .btn.secondary { background: #6c757d; box-shadow: 0 3px #545b62; }

        /* History */
        #history-section { margin-top: 20px; border-top: 1px dashed #ccc; padding-top: 15px; }
        .history-table { width: 100%; font-size: 13px; border-collapse: collapse; margin-top: 10px; }
        .history-table th { text-align: left; color: #666; border-bottom: 1px solid #eee; padding: 5px; }
        .history-table td { padding: 8px 5px; border-bottom: 1px solid #eee; }
        .history-score { color: var(--accent); font-weight: bold; }
        .clear-hist-btn { background: none; border: none; color: #999; font-size: 12px; text-decoration: underline; margin-top: 10px; padding: 5px; }

        /* Exam Screen */
        #exam-screen { display: none; padding-top: 5px; }
        
        .top-bar-compact {
            position: sticky; top: 0; z-index: 1000;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: -15px -15px 15px -15px;
            padding: 8px 10px;
            display: flex; align-items: center; justify-content: space-between; gap: 5px;
            transition: all 0.3s;
        }

        .top-bar-review {
            background: var(--review-bg);
            border-bottom: 1px solid #ffeeba;
        }

        .timer-compact {
            font-family: monospace; font-size: 16px; font-weight: bold; color: var(--accent);
            white-space: nowrap;
        }

        .nav-compact-group { display: flex; flex: 1; justify-content: center; gap: 4px; }
        .mini-nav-btn {
            background: #f0f2f5; border: 1px solid #e1e4e8; border-radius: 4px;
            padding: 4px 6px; font-size: 11px; color: #555;
            text-align: center; cursor: pointer; line-height: 1.2;
            min-width: 55px;
        }
        .mini-nav-btn b { display: block; font-size: 12px; color: #333; }
        .mini-nav-btn span { font-size: 10px; color: #888; }
        .mini-nav-btn:active { background: #e2e6ea; }

        .submit-compact-btn {
            padding: 6px 10px; font-size: 13px; margin: 0; 
            box-shadow: none; width: auto; white-space: nowrap;
            background: var(--accent);
        }

        h3.section-title {
            margin: 20px 0 10px 0;
            scroll-margin-top: 70px; 
        }

        /* Question Card */
        .question-card { background: var(--card); padding: 15px; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
        .q-header { display: flex; align-items: flex-start; gap: 8px; font-size: 16px; font-weight: bold; margin-bottom: 15px; }
        .q-tag { background: var(--primary); color: white; font-size: 11px; padding: 2px 6px; border-radius: 4px; white-space: nowrap; margin-top: 3px; }
        
        .option-item {
            display: flex; align-items: flex-start; min-height: 48px;
            margin: 10px 0; padding: 12px;
            background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px;
            cursor: pointer; transition: all 0.1s;
        }
        .option-item input { margin-top: 4px; margin-right: 10px; transform: scale(1.3); }
        .option-item.selected { background: #e8f5e9; border-color: var(--primary); color: var(--primary); font-weight: 500; }
        
        .analysis-box { background: var(--review-bg); padding: 15px; margin-top: 15px; border-radius: 8px; color: var(--review-text); display: none; font-size: 14px; }
        .show-analysis .analysis-box { display: block; }
        .wrong-ans .q-header { color: var(--accent); }
        .wrong-ans .option-item.selected { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }

        /* Footer */
        .footer {
            text-align: center; padding: 20px 0;
            font-size: 12px; color: #aaa;
            border-top: 1px solid #eee; margin-top: auto;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header" id="main-header">
        <div class="logo-box">KK</div>
        <h1>2025å¹´å†›äº‹çŸ¥è¯†ç«èµ›æ¨¡æ‹Ÿç³»ç»Ÿ</h1>
        <div class="sub-title">é—­å·æœºè¯• | é™æ—¶60åˆ†é’Ÿ | æ€»åˆ†100åˆ†</div>
    </div>

    <div id="welcome-screen" class="card-box">
        <h2 style="text-align: center; color:var(--primary); margin-top:0;">å‡†å¤‡å¥½äº†å—ï¼Ÿ</h2>
        <div style="background:#eef7ee; padding:15px; border-radius:8px; font-size:14px; color:#333; margin-bottom:20px;">
            <p><strong>ğŸ¯ è€ƒè¯•è§„åˆ™ï¼š</strong></p>
            <ul style="padding-left:20px; margin:5px 0;">
                <li><strong>é¢˜é‡ï¼š</strong>300é¢˜ (å•é€‰150+å¤šé€‰100+åˆ¤æ–­50)</li>
                <li><strong>æ—¶é•¿ï¼š</strong>60åˆ†é’Ÿ (å€’è®¡æ—¶ç»“æŸè‡ªåŠ¨äº¤å·)</li>
                <li><strong>è®°å½•ï¼š</strong>ç³»ç»Ÿä¼šè‡ªåŠ¨ä¿å­˜æ‚¨çš„ç»ƒä¹ å†å²</li>
            </ul>
        </div>
        <button class="btn" onclick="startExam()">å¼€å§‹è€ƒè¯•</button>
        
        <div id="history-section">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <strong>ğŸ“œ ç»ƒä¹ å†å²</strong>
                <button class="clear-hist-btn" onclick="clearHistory()">æ¸…ç©ºè®°å½•</button>
            </div>
            <div id="history-list-container">
                <p style="color:#999; font-size:12px; text-align:center;">æš‚æ— ç»ƒä¹ è®°å½•</p>
            </div>
        </div>
    </div>

    <div id="exam-screen">
        <div class="top-bar-compact" id="exam-top-bar">
            <div class="timer-compact" id="timer">60:00</div>
            <div class="nav-compact-group">
                <div class="mini-nav-btn" onclick="scrollToSection('single')"><b>å•é€‰</b><span id="prog-single">0/150</span></div>
                <div class="mini-nav-btn" onclick="scrollToSection('multi')"><b>å¤šé€‰</b><span id="prog-multi">0/100</span></div>
                <div class="mini-nav-btn" onclick="scrollToSection('tf')"><b>åˆ¤æ–­</b><span id="prog-tf">0/50</span></div>
            </div>
            <button class="btn danger submit-compact-btn" onclick="submitExam(true)">äº¤å·</button>
        </div>

        <div class="top-bar-compact top-bar-review" id="review-top-bar" style="display:none;">
            <div style="font-weight:bold; color:var(--review-text); font-size:14px;">ğŸ“– é”™é¢˜è§£æ</div>
            <div style="display:flex; gap:10px;">
                <button class="mini-nav-btn" id="filter-btn" onclick="toggleWrongOnly(this)" style="width:auto; padding:5px 12px; background:#fff; border-color:#d4a845;">åªçœ‹é”™é¢˜</button>
                <button class="submit-compact-btn" onclick="location.reload()" style="background:#6c757d;">é€€å‡º</button>
            </div>
        </div>

        <div id="paper-content"></div>
        
        <div id="exam-bottom-action" style="padding: 20px 0;">
            <button class="btn danger" onclick="submitExam(true)">ç¡®è®¤æäº¤è¯•å·</button>
        </div>
    </div>

    <div id="result-screen" class="card-box" style="display:none; text-align:center;">
        <h2 style="color:var(--primary)">è€ƒè¯•ç»“æŸ</h2>
        <div style="font-size:50px; font-weight:900; color:var(--primary); margin:10px 0;">
            <span id="score-display">0</span> <span style="font-size:18px; color:#666;">åˆ†</span>
        </div>
        <p>ç­”å¯¹: <strong id="correct-count">0</strong> / 300 é¢˜</p>
        <div style="background:#fff3cd; padding:10px; border-radius:6px; color:#856404; font-size:14px; margin:20px 0;">
            é”™é¢˜å·²æ ‡çº¢å¹¶æ˜¾ç¤ºè§£æï¼Œå‘ä¸‹æ»‘åŠ¨æŸ¥çœ‹
        </div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <button class="btn secondary" onclick="reviewWrong()">æŸ¥çœ‹é”™é¢˜</button>
            <button class="btn" onclick="location.reload()">å†ç»ƒä¸€æ¬¡</button>
        </div>
    </div>

    <div class="footer">
        ç‰ˆæƒæ‰€æœ‰ &copy; 2025 å†›äº‹çŸ¥è¯†ç«èµ›æ¨¡æ‹Ÿç³»ç»Ÿ<br>
        Created By <span>Kingkong</span>
    </div>
</div>

<script src="questions_data.js"></script>

<script>
    let currentPaper = [];
    let userAnswers = {}; 
    let progressStats = { single: 0, multi: 0, tf: 0 };
    let timeLeft = 3600; 
    let timerId = null;
    let isExamFinished = false;
    let isWrongOnlyMode = false;

    window.onload = function() { renderHistory(); };

    function shuffle(arr) {
        let m = arr.length, t, i;
        while (m) {
            i = Math.floor(Math.random() * m--);
            t = arr[m]; arr[m] = arr[i]; arr[i] = t;
        }
        return arr;
    }

    window.onbeforeunload = function(e) {
        if (!isExamFinished && document.getElementById('exam-screen').style.display === 'block') {
            e.returnValue = 'è€ƒè¯•è¿›è¡Œä¸­ï¼Œç¦»å¼€å°†ä¸¢å¤±è¿›åº¦';
            return e.returnValue;
        }
    };

    function startExam() {
        if (typeof QUESTION_DB === 'undefined') {
            alert("é”™è¯¯ï¼šæœªæ‰¾åˆ°é¢˜åº“æ–‡ä»¶ questions_data.js");
            return;
        }

        userAnswers = {}; 
        progressStats = { single: 0, multi: 0, tf: 0 };
        updateProgressUI();

        const singles = shuffle([...QUESTION_DB.single]).slice(0, 150);
        const multis = shuffle([...QUESTION_DB.multi]).slice(0, 100);
        const tfs = shuffle([...QUESTION_DB.tf]).slice(0, 50);

        currentPaper = [...singles, ...multis, ...tfs];
        renderPaper(singles, multis, tfs);

        document.getElementById('welcome-screen').style.display = 'none';
        document.getElementById('main-header').style.display = 'none';
        document.getElementById('exam-screen').style.display = 'block';
        window.scrollTo(0, 0);

        clearInterval(timerId);
        timerId = setInterval(updateTimer, 1000);
    }

    function renderPaper(singles, multis, tfs) {
        const container = document.getElementById('paper-content');
        container.innerHTML = '';
        let globalIdx = 1;

        const sections = [
            { id: 'single', name: 'ä¸€ã€å•é€‰é¢˜', data: singles, type: 'radio' },
            { id: 'multi', name: 'äºŒã€å¤šé€‰é¢˜', data: multis, type: 'checkbox' },
            { id: 'tf', name: 'ä¸‰ã€åˆ¤æ–­é¢˜', data: tfs, type: 'radio' }
        ];

        sections.forEach(sec => {
            if(sec.data.length === 0) return;
            
            const title = document.createElement('h3');
            title.className = "section-title";
            title.id = `section-${sec.id}`;
            title.innerHTML = `${sec.name} <small style="color:#666; font-weight:normal; font-size:12px;">(å…±${sec.data.length}é¢˜)</small>`;
            container.appendChild(title);

            sec.data.forEach(q => {
                const card = document.createElement('div');
                card.className = 'question-card';
                card.id = `q-${q.id}`;
                
                let optsHtml = '';
                
                q.options.forEach((opt, index) => {
                    // å¼ºåˆ¶ç”Ÿæˆ A, B, C, D ä½œä¸º Key
                    const key = String.fromCharCode(65 + index); 
                    // æ˜¾ç¤ºç”¨çš„æ–‡æœ¬ï¼Œç§»é™¤å·²æœ‰çš„ "A." ç­‰å‰ç¼€
                    const txt = opt.replace(/^[A-F\d][\.\ã€\s]+/, '').trim();
                    
                    optsHtml += `
                        <label class="option-item" id="lbl-${q.id}-${key}">
                            <input type="${sec.type}" name="${q.id}" value="${key}" 
                                   onchange="handleAnswer('${q.id}', '${sec.type}', '${sec.id}')">
                            <div style="flex:1;">
                                <span style="font-weight:bold; margin-right:5px;">${key}.</span>${txt}
                            </div>
                        </label>`;
                });

                card.innerHTML = `
                    <div class="q-header">
                        <span class="q-tag">${sec.name.substr(0,2)}</span>
                        <span>${globalIdx}. ${q.question}</span>
                    </div>
                    <div class="options">${optsHtml}</div>
                    <div class="analysis-box">
                        <div style="margin-bottom:5px;"><strong>âœ… æ­£ç¡®ç­”æ¡ˆï¼š${q.answer}</strong></div>
                        <div>ğŸ“– ${q.analysis || 'æš‚æ— è§£æ'}</div>
                    </div>
                `;
                container.appendChild(card);
                globalIdx++;
            });
        });
    }

    function handleAnswer(qId, type, sectionId) {
        if(isExamFinished) return;
        
        const inputs = document.getElementsByName(qId);
        let val = [];
        
        for(let inp of inputs) {
            const lbl = document.getElementById(`lbl-${qId}-${inp.value}`);
            if(inp.checked) {
                val.push(inp.value);
                lbl.classList.add('selected');
            } else {
                if(type === 'radio' || !inp.checked) lbl.classList.remove('selected');
            }
        }

        const finalVal = type === 'radio' ? (val[0]||'') : val.sort().join('');
        const oldVal = userAnswers[qId] || "";
        
        userAnswers[qId] = finalVal;

        if (!oldVal && finalVal) {
            progressStats[sectionId]++;
            updateProgressUI();
        } else if (oldVal && !finalVal) {
            progressStats[sectionId]--;
            updateProgressUI();
        }
    }

    function updateProgressUI() {
        document.getElementById('prog-single').innerText = `${progressStats.single}/150`;
        document.getElementById('prog-multi').innerText = `${progressStats.multi}/100`;
        document.getElementById('prog-tf').innerText = `${progressStats.tf}/50`;
    }

    function updateTimer() {
        if(timeLeft > 0) {
            timeLeft--;
            const m = Math.floor(timeLeft/60).toString().padStart(2,'0');
            const s = (timeLeft%60).toString().padStart(2,'0');
            const tEl = document.getElementById('timer');
            tEl.innerText = `${m}:${s}`;
            if(timeLeft < 300) tEl.style.color = 'red';
        } else {
            submitExam(false);
        }
    }

    function scrollToSection(secId) {
        const el = document.getElementById(`section-${secId}`);
        if(el) {
            el.scrollIntoView({ behavior: 'smooth' });
        }
    }

    // ã€é‡è¦ä¿®æ”¹ã€‘é˜…å·å‡½æ•°ï¼šæ™ºèƒ½ç¿»è¯‘ç­”æ¡ˆ
    function submitExam(manual) {
        if(manual && !confirm("ç¡®å®šè¦äº¤å·å—ï¼Ÿ")) return;
        
        clearInterval(timerId);
        isExamFinished = true;
        window.onbeforeunload = null;

        let correct = 0;
        currentPaper.forEach(q => {
            const uAns = userAnswers[q.id] || "";
            const el = document.getElementById(`q-${q.id}`);
            const inps = document.getElementsByName(q.id);
            for(let inp of inps) inp.disabled = true;

            // --- æ ¸å¿ƒä¿®å¤é€»è¾‘ ---
            // è·å–æ•°æ®åº“é‡Œçš„åŸå§‹ç­”æ¡ˆï¼ˆå»é™¤é¦–å°¾ç©ºæ ¼ï¼‰
            let correctKey = q.answer.trim();
            
            // åˆ¤æ–­ï¼šå¦‚æœç­”æ¡ˆä¸æ˜¯çº¯å­—æ¯ï¼ˆæ¯”å¦‚æ˜¯æ±‰å­—â€œæ­£ç¡®â€ï¼‰ï¼Œæˆ‘ä»¬å°±å»é€‰é¡¹é‡Œæ‰¾å®ƒå¯¹åº”çš„æ˜¯Aè¿˜æ˜¯B
            // æ­£åˆ™è¯´æ˜ï¼š/^[A-Z]+$/i æµ‹è¯•æ˜¯å¦å…¨æ˜¯å­—æ¯
            const isLetterOnly = /^[A-Z]+$/i.test(correctKey);

            if (!isLetterOnly) {
                // éå†è¯¥é¢˜ç›®çš„é€‰é¡¹
                q.options.forEach((opt, index) => {
                    // æ¸…æ´—é€‰é¡¹æ–‡æœ¬ï¼ˆå’Œæ¸²æŸ“æ—¶é€»è¾‘ä¸€æ ·ï¼Œå»æ‰ "A." ç­‰å‰ç¼€ï¼‰
                    const optTxt = opt.replace(/^[A-F\d][\.\ã€\s]+/, '').trim();
                    // å¦‚æœæ¸…æ´—åçš„é€‰é¡¹æ–‡æœ¬ å’Œ ç­”æ¡ˆæ–‡æœ¬ ä¸€æ ·
                    if (optTxt === correctKey) {
                        // æŠŠå®ƒç¿»è¯‘æˆå­—æ¯ï¼š0->A, 1->B
                        correctKey = String.fromCharCode(65 + index);
                    }
                });
            } else {
                // å¦‚æœæœ¬æ¥å°±æ˜¯å­—æ¯ï¼ˆå¦‚ "ABC"ï¼‰ï¼Œè½¬å¤§å†™ç»Ÿä¸€ä¸€ä¸‹å³å¯
                correctKey = correctKey.toUpperCase();
            }
            // ------------------

            if(uAns === correctKey) {
                correct++;
                el.classList.add('correct-ans');
            } else {
                el.classList.add('wrong-ans');
                el.classList.add('show-analysis');
            }
        });

        const score = ((correct / 300) * 100).toFixed(1).replace(/\.0$/, '');
        saveHistory(score, 3600 - timeLeft);

        document.getElementById('score-display').innerText = score;
        document.getElementById('correct-count').innerText = correct;
        
        document.getElementById('main-header').style.display = 'flex';
        document.getElementById('exam-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
        window.scrollTo(0,0);
    }

    function reviewWrong() {
        document.getElementById('result-screen').style.display = 'none';
        document.getElementById('exam-screen').style.display = 'block';
        document.getElementById('exam-top-bar').style.display = 'none';
        document.getElementById('review-top-bar').style.display = 'flex';
        document.getElementById('exam-bottom-action').style.display = 'none';

        isWrongOnlyMode = false; 
        toggleWrongOnly(document.getElementById('filter-btn'));
        window.scrollTo(0,0);
    }

    function toggleWrongOnly(btn) {
        isWrongOnlyMode = !isWrongOnlyMode;
        
        const allCards = document.querySelectorAll('.question-card');
        const headers = document.querySelectorAll('.section-title');

        allCards.forEach(card => {
            if (isWrongOnlyMode) {
                if (!card.classList.contains('wrong-ans')) {
                    card.style.display = 'none';
                } else {
                    card.style.display = 'block';
                }
            } else {
                card.style.display = 'block';
            }
        });

        headers.forEach(h => {
            h.style.display = isWrongOnlyMode ? 'none' : 'block';
        });

        btn.innerText = isWrongOnlyMode ? 'æ˜¾ç¤ºå…¨éƒ¨' : 'åªçœ‹é”™é¢˜';
        btn.style.background = isWrongOnlyMode ? '#ffc107' : '#fff';
    }

    function saveHistory(score, durationSec) {
        const historyItem = {
            date: new Date().toLocaleString(),
            score: score,
            duration: formatDuration(durationSec)
        };
        let history = JSON.parse(localStorage.getItem('kk_exam_history') || '[]');
        history.unshift(historyItem);
        localStorage.setItem('kk_exam_history', JSON.stringify(history));
    }

    function renderHistory() {
        const container = document.getElementById('history-list-container');
        const history = JSON.parse(localStorage.getItem('kk_exam_history') || '[]');
        
        if (history.length === 0) {
            container.innerHTML = '<p style="color:#999; font-size:12px; text-align:center; padding:10px;">æš‚æ— ç»ƒä¹ è®°å½•ï¼ŒåŠ æ²¹ï¼</p>';
            return;
        }

        let html = `
        <table class="history-table">
            <thead>
                <tr><th>æ—¶é—´</th><th>è€—æ—¶</th><th>å¾—åˆ†</th></tr>
            </thead>
            <tbody>
        `;
        history.slice(0, 5).forEach(item => {
            html += `<tr><td>${item.date.split(' ')[0]}</td><td>${item.duration}</td><td class="history-score">${item.score}</td></tr>`;
        });
        html += '</tbody></table>';
        container.innerHTML = html;
    }

    function clearHistory() {
        if(confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ")) {
            localStorage.removeItem('kk_exam_history');
            renderHistory();
        }
    }

    function formatDuration(seconds) {
        const m = Math.floor(seconds / 60);
        const s = seconds % 60;
        return `${m}åˆ†${s}ç§’`;
    }
</script>

</body>
</html>